// Generated by CoffeeScript 1.8.0
(function() {
  $.fn.userAvatar = {};

  $.fn.userAvatar.init = function() {
    $(document).on('submit', '#uploadimage', $.fn.userAvatar.uploadFile);
    return $(document).on('change', '#file', $.fn.userAvatar.changeFile);
  };

  $.fn.userAvatar.uploadFile = function(e) {
    e.preventDefault();
    return $.ajax({
      url: '/fels_41/users/upload_avatar',
      type: 'POST',
      data: new FormData(this),
      contentType: false,
      cache: false,
      processData: false,
      success: function(data) {
        return $('#message').html(data);
      }
    });
  };

  $.fn.userAvatar.changeFile = function(e) {
    var file, image_file, match, reader;
    file = this.files[0];
    image_file = file.type;
    match = ['image/jpeg', 'image/png', 'image/jpg'];
    if (!((image_file === match[0]) || (image_file === match[1]) || (image_file === match[2]))) {
      $('#previewing').attr('src', 'img/no_image_icon.gif');
      $('#message').html('<p>Please Select A valid Image File<br>Only jpeg, jpg and png Images type allowed</p>');
      return false;
    } else {
      reader = new FileReader();
      reader.onload = $.fn.userAvatar.imageLoad;
      return reader.readAsDataURL(this.files[0]);
    }
  };

  $.fn.userAvatar.imageLoad = function(e) {
    $('#file').css('color', 'green');
    $('#image_preview').css('display', 'block');
    $('#previewing').attr('src', e.target.result);
    $('#previewing').attr('width', '250px');
    return $('#previewing').attr('height', '230px');
  };

}).call(this);
